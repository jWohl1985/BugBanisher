@using BugBanisher.Models.ViewModels

@model ProjectViewModel

<div class="pagetitle">
	<h1>View Project: @Model.Project.Name</h1>
	<nav>
		<ol class="breadcrumb">
			<li class="breadcrumb-item">Projects</li>
			<li class="breadcrumb-item">Active</li>
			<li class="breadcrumb-item active">@Model.Project.Name</li>
		</ol>
	</nav>
</div>

<div class="row">

	<!-- Project Info Card -->
	<div class="col-lg-6">
		<div class="card">
			<div class="card-header">
				<h5 class="card-text d-inline">Project Info: <strong>@Model.Project.Name</strong></h5>
				<a class="btn btn-sm btn-info ms-3" asp-controller="Projects" asp-action="EditProject" asp-route-projectId="@Model.Project.Id">Edit</a>
			</div>
			<div class="card-body">

				<p class="card-text mt-3">
					<strong>Description:</strong><br/><br/>
					@Model.Project.Description
				</p>

				<div class="row d-flex justify-space-between">

					<div class="col">
						<p class="card-text"><strong>Created:</strong>
						<br/>@Model.Project.Created.ToShortDateString()
						</p>
					</div>
					
					<div class="col">
						<p class="card-text"><strong>Deadline:</strong>
						<br/>@Model.Project.Deadline.ToShortDateString()
					</p>
					</div>
					
				</div>
				
			</div>
		</div>
	</div>

	<!-- Project Team Card -->
	<div class="col-lg-6">
		<div class="card">
				<div class="card-header">
					<h5 class="card-text">Project Team</h5>
				</div>
				<div class="card-body">

					<!-- Project Manager -->
					<p class="card-text mt-3"><strong>Project Manager:</strong></p>
					@if(Model.ProjectManager is null)
					{
						<p class="card-text text-danger">Project manager is unassigned!</p>
					}
					else
					{
						<div class="row d-flex justify-content-start align-items-center">
							<div class="col-3 col-lg-1">
								<img class="img-fluid rounded-circle" width="50" height="50" src="data:img/*;base64,@Convert.ToBase64String(Model.ProjectManager.PictureData)">
							</div>
							<div class="col-9 col-lg-11">
								<p class="card-text">@Model.ProjectManager.FullName</p>
							</div>
						</div>
					}
				
					<hr />

					<!-- Developers -->
					<p class="card-text mt-3"><strong>Developers:</strong></p>
					@if (Model.Developers.Count == 0)
					{
						<p class="card-text">No developers are assigned to this project.</p>
					}
					@foreach (AppUser developer in Model.Developers)
					{
						<div class="row d-flex justify-content-start align-items-center mb-2">
							<div class="col-3 col-lg-1">
								<img class="img-fluid rounded-circle" width="50" height="50" src="data:img/*;base64,@Convert.ToBase64String(developer.PictureData)">
							</div>
							<div class="col-9 col-lg-11">
								<p class="card-text">@developer.FullName</p>
							</div>
						</div>
					}

					<hr/>

					<!-- Members -->
					<p class="card-text mt-3"><strong>Members:</strong></p>
					@if (Model.Members.Count == 0)
					{
						<p class="card-text">No members are assigned to this project.</p>
					}
					@foreach (AppUser member in Model.Members)
					{
						<div class="row d-flex justify-content-start align-items-center mb-2">
							<div class="col-3 col-lg-1">
								<img class="img-fluid rounded-circle" width="50" height="50" src="data:img/*;base64,@Convert.ToBase64String(member.PictureData)">
							</div>
							<div class="col-9 col-lg-11">
								<p class="card-text">@member.FullName</p>
							</div>
						</div>
					}

				</div>
		</div>
	</div>

	<!-- Tickets Card -->
	<div class="col">
		@if (User.IsInRole(nameof(Roles.Admin)) || User.IsInRole(nameof(Roles.ProjectManager)) || User.IsInRole(nameof(Roles.Developer)))
		{
			<a class="btn btn-sm btn-success mb-3" asp-controller="Tickets" asp-action="CreateTicket" asp-route-projectId="@Model.Project.Id">Create Ticket</a>
		}

		<div class="card">
			<div class="card-header">
				<h5 class="card-text">Active Tickets</h5>
			</div>

			<table class="table table-sm table-striped table-bordered">

				<thead>
					<tr>
						<th>Link</th>
						<th>Created</th>
						<th>Ticket Name</th>
						<th>Assigned Developer</th>
						<th>Priority</th>
						<th>Type</th>
						<th>Status</th>
					</tr>
				</thead>

				<tbody>
					@foreach (Ticket ticket in Model.Tickets)
					{
						<tr class="align-middle">
							<td class="text-center p-0"><a asp-controller="Tickets" asp-action="ViewTicket" asp-route-ticketId="@ticket.Id"><img class="img-fluid" src="~/img/ticket.png" /></a></td>
							<td>@ticket.Created.ToShortDateString()</td>
							<td>@ticket.Title</td>
							<td class="@Model.GetDeveloperTextFormat(ticket)">@(ticket.Developer is not null ? ticket.Developer.FullName : "Unassigned")</td>
							<td class="text-center"><span class="badge @Model.GetPriorityBadgeFormat(ticket)">@ticket.Priority!.Description</span></td>
							<td>@ticket.Type!.Description</td>
							<td class="text-center"><span class="badge @Model.GetStatusBadgeFormat(ticket)">@ticket.Status!.Description</span></td>
						</tr>
					}
				</tbody>
			</table>
			
		</div>
	</div>

</div>
